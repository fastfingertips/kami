<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Interactive origami folding demo that responds to device posture." />
  <meta name="theme-color" content="#201a14" />
  <title>kami</title>
  <link rel="icon" type="image/png" href="icon.png" />
  <link rel="preload" as="image" href="textures/wood.jpg" />
  <link rel="preload" as="image" href="textures/paper.jpg" />
  <link rel="stylesheet" href="/src/style.css" />
  <style>
    /* ========== GLOBAL HUD STYLES ========== */
    #hud {
      font-size: 13px;
    }

    /* Settings Icon Button */
    #toggleHelp {
      width: 40px;
      height: 40px;
      padding: 0;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 12px;
      color: rgba(255, 255, 255, 0.9);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    #toggleHelp:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: scale(1.05);
    }

    #toggleHelp[aria-pressed="true"] {
      background: rgba(255, 255, 255, 0.25);
      border-color: rgba(255, 255, 255, 0.3);
    }

    #toggleHelp svg {
      width: 18px;
      height: 18px;
    }

    /* Modern Toggle Switch Style for Checkboxes */
    .input-row label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 100%;
      cursor: pointer;
      padding: 8px 4px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.9);
      font-family: system-ui, -apple-system, sans-serif;
      /* Clean font */
    }

    .input-row input[type="checkbox"] {
      appearance: none;
      width: 42px;
      height: 24px;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 24px;
      position: relative;
      cursor: pointer;
      transition: all 0.25s cubic-bezier(0.4, 0.0, 0.2, 1);
      margin-left: 16px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
      /* Prevent shrinking */
    }

    .input-row input[type="checkbox"]::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.25s cubic-bezier(0.4, 0.0, 0.2, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .input-row input[type="checkbox"]:checked {
      background: #34c759;
      /* iOS Green */
      border-color: #34c759;
    }

    .input-row input[type="checkbox"]:checked::after {
      transform: translateX(18px);
    }

    /* Better spacing for settings items */
    .input-row {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      padding: 4px 0 !important;
      margin: 0 !important;
    }

    .input-row:last-child {
      border-bottom: none;
    }

    /* Make slider rows align nicely too */
    .input-row:not(:has(input[type="checkbox"])) {
      padding: 8px 4px !important;
    }

    /* Action Buttons (Reset, Undo) */
    #resetActive,
    #undo {
      height: 40px;
      line-height: 1;
      padding: 0 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 600;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.08);
      border: 1px solid rgba(255, 255, 255, 0.12);
      transition: all 0.15s ease;
      white-space: nowrap;
    }

    #resetActive:hover:not(:disabled),
    #undo:hover:not(:disabled) {
      background: rgba(255, 255, 255, 0.15);
    }

    /* ========== PC / LAPTOP LAYOUT ========== */
    body[data-device="laptop"] #hud {
      left: auto;
      right: 16px;
      top: 16px;
      padding: 8px;
      border-radius: 16px;
      min-width: auto;
      max-width: 320px;
    }

    body[data-device="laptop"] .row {
      display: flex;
      gap: 6px;
      align-items: center;
      margin-bottom: 0;
      flex-wrap: nowrap;
      justify-content: flex-end;
    }

    /* Settings icon LAST (rightmost), actions before it */
    body[data-device="laptop"] #toggleHelp {
      order: 10;
      margin-left: 8px;
    }

    body[data-device="laptop"] #foldFallback {
      display: none !important;
    }

    /* Dropdown Panel */
    body[data-device="laptop"] .help {
      margin-top: 10px;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    body[data-device="laptop"] #foldHelp,
    body[data-device="laptop"] #gestureHelp {
      padding: 6px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.06);
      margin-bottom: 8px;
    }

    body[data-device="laptop"] .input-row {
      padding: 4px 0;
    }

    body[data-device="laptop"] #status {
      display: block;
      margin-top: 12px;
      padding: 6px 8px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 6px;
      font-family: 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', monospace;
      font-size: 10px;
      color: rgba(255, 255, 255, 0.5);
      border: 1px solid rgba(255, 255, 255, 0.05);
      text-align: center;
      letter-spacing: 0.5px;
    }

    #status {
      display: block;
      font-size: 9px;
      opacity: 0.6;
      text-align: center;
      margin-top: 8px;
      font-family: monospace;
      color: rgba(255, 255, 255, 0.5);
    }

    /* ========== MOBILE / PHONE LAYOUT ========== */
    body[data-device="phone"] #hud {
      top: auto;
      bottom: 20px;
      left: 16px;
      right: 16px;
      width: auto;
      max-width: none;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.12);
      border-radius: 20px;
      padding: 12px;
    }

    body[data-device="phone"] .row {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      gap: 8px;
      align-items: center;
      margin-bottom: 0;
    }

    /* Big centered Fold button */
    /* Make Mobile fold button big */
    body[data-device="phone"] #foldFallback {
      flex: 1;
      padding: 14px 20px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 12px;
      display: flex !important;
      justify-content: center;
      order: 2;
    }

    body[data-device="phone"] #foldFallback:active {
      transform: scale(0.98);
      background: rgba(255, 255, 255, 0.25);
    }

    body[data-device="phone"] #resetActive,
    body[data-device="phone"] #undo {
      padding: 12px;
      font-size: 11px;
    }

    body[data-device="phone"] #toggleHelp {
      width: 44px;
      height: 44px;
    }

    /* Mobile dropdown panel */
    body[data-device="phone"] .help {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    /* Help Text Badges & Layout */
    .help-row {
      display: flex;
      align-items: center;
      margin-bottom: 6px;
      font-size: 13px;
      color: rgba(255, 255, 255, 0.9);
      line-height: 1.3;
      white-space: nowrap;
    }

    .help-row:last-child {
      margin-bottom: 0;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0 6px;
      background: rgba(255, 193, 7, 0.15);
      border: 1px solid rgba(255, 193, 7, 0.3);
      color: #ffca28;
      border-radius: 4px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      margin-right: 8px;
      min-width: 60px;
      height: 20px;
      flex-shrink: 0;
    }

    .sep {
      display: inline-block;
      margin: 0 6px;
      opacity: 0.4;
      transform: scale(1.2);
    }

    .val {
      color: rgba(255, 255, 255, 0.8);
      font-size: 12px;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  </style>
</head>

<body data-device="laptop">
  <canvas id="c"></canvas>

  <div id="hud">
    <div class="row">
      <button id="resetActive" type="button">Reset</button>
      <button id="undo" type="button" disabled>Undo</button>
      <button id="foldFallback" type="button">Fold</button>
      <button id="toggleHelp" type="button" aria-controls="helpBlock" aria-pressed="false" aria-label="Settings">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
          <path
            d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1.51 1H15a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1Z" />
        </svg>
      </button>
    </div>

    <div class="help" id="helpBlock" style="display: none">
      <!-- ... help content ... -->

      <div id="foldHelp"></div>
      <div id="gestureHelp"></div>
      <div class="row" aria-label="Motion options">
        <div class="input-row mono">
          <span>Stability threshold:</span>
          <span id="stableAccelValue">0.35 m/sÂ²</span>
          <input id="stableAccel" type="range" min="0" max="3" step="0.05" value="0.35" />
        </div>
        <div class="input-row mono">
          <label title="Reverse which side the fold prefers to move toward when triggered">
            Invert fold direction
            <input id="invertFoldDirection" type="checkbox" />
          </label>
        </div>
        <div class="input-row mono" aria-label="Hinge controls">
          <span>X:</span>
          <input id="manualHingeX" type="range" min="0" max="100" step="1" value="50" />
          <span>Y:</span>
          <input id="manualHingeY" type="range" min="0" max="100" step="1" value="50" />
        </div>
        <div class="input-row mono">
          <label>
            Flip hinge
            <input id="manualHingeFlip" type="checkbox" />
          </label>
        </div>
      </div>

      <div class="mono" id="status" role="status" aria-live="polite"></div>

      <div class="input-row mono"
        style="justify-content: space-between; margin-top: 8px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 12px !important;">
        <a id="buyCoffee" href="https://www.buymeacoffee.com/maxwase" target="_blank"
          style="display: inline-flex; align-items: center; gap: 6px; color: #FFDD00; text-decoration: none; font-weight: 600; font-size: 11px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M20.216 6.415l-.132-.666c-1.197-5.493-9.156-5.493-8.825-3.125C7.942 1.516 3 5.861 3 13.5c0 3.326 2.019 6.264 5.029 7.643 1.258 5.182 7.781 4.595 12.053-.948 1.954-2.482 2.651-7.057.134-13.78zm-4.305 2.112l-1.63 7.857c-.15.727-.478.784-1.072.583-3.692-1.246-3.811-1.306-4.526-7.857.032-1.996 1.488-2.678 4.249-2.678 2.502 0 3.122.955 2.979 2.095z" />
          </svg>
          Buy Coffee
        </a>

        <a id="repoLink" href="https://github.com/maxwase/kami" target="_blank" rel="noreferrer"
          style="display: inline-flex; align-items: center; gap: 6px; color: rgba(255,255,255,0.6); text-decoration: none; font-size: 11px;">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path
              d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
          </svg>
          Source
        </a>
      </div>
    </div>
  </div>

  <script type="module" src="/src/main.ts"></script>
</body>

</html>